---

---

<div class="mt-12">
  <p class="mb-3 text-sm opacity-70">
    How did this chapter feel?
  </p>

  <div class="flex flex-wrap gap-3">
    <button data-reaction="moved">‚ù§Ô∏è Moved me</button>
    <button data-reaction="intense">üî• Intense</button>
    <button data-reaction="atmospheric">üåô Atmospheric</button>
    <button data-reaction="beautiful">‚ú® Beautifully written</button>
  </div>
</div>

<script>
const STORAGE_KEY = "vicitales_reactions";
const path = location.pathname;

const sessionId =
  sessionStorage.getItem("vicitales_session") ||
  crypto.randomUUID();

sessionStorage.setItem("vicitales_session", sessionId);

// -----------------------------
// Load stored reactions
// -----------------------------
const stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
const currentReactions = new Set(stored[path] || []);

// -----------------------------
// Apply UI state
// -----------------------------
document.querySelectorAll("[data-reaction]").forEach((btn: any) => {
  const reaction = btn.dataset.reaction;

  if (currentReactions.has(reaction)) {
    btn.style.opacity = "0.5";
    btn.disabled = true;
  }

  btn.addEventListener("click", async () => {
    if (currentReactions.has(reaction)) return;

    // optimistic UI
    btn.style.opacity = "0.5";
    btn.disabled = true;

    currentReactions.add(reaction);
    stored[path] = Array.from(currentReactions);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(stored));

    await fetch("/api/react", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        path,
        sessionId,
        reaction
      })
    });
  });
});
</script>